!function(){"use strict";var e=require("fs"),s=require("path"),n=__dirname,i,t,a,r=/\{MANIFEST\-START\}[\s\S]*?\{MANIFEST\-END\}/g,o=s.join(s.dirname(n),"js","app-schemas.js"),c=s.join(n,"manifest.json"),l=[s.basename(__filename),"manifest.json","options.json","README.txt",".DS_Store","min","styles.css"],m={},f=function(n){var i=n.substr(0,n.length-s.extname(n).length)+".json",t=s.dirname(n)+"/config.json",a;return e.existsSync&&e.existsSync(i)||s.existsSync&&s.existsSync(i)?a=i:e.existsSync&&e.existsSync(t)||s.existsSync&&s.existsSync(t)?a=t:(console.log("Can't find options file for schema at either "+i+" or "+t+". This file should define the schema-family so that Doctored.js can offer a better UI for editing. The schema-family value should align with a key in app-schemas.js and the variable doctored.schema_family = { ... "),process.exit()),JSON.parse(e.readFileSync(a))},h=function(i,t){var a,r,o,c=[];for(a=0;a<i.length;a++)if(r=i[a],!(l.indexOf(r)>=0)&&".json"!==s.extname(r))if(o=s.join(t,r),e.lstatSync(o).isDirectory())c.push({schema_family:r,children:h(e.readdirSync(o),o)});else{var m=f(o);c.push({schema:o.replace(n,""),label:r.replace(s.extname(r),""),schema_family:m["schema-family"],elements:m.elements})}return c};m=h(e.readdirSync(n),n),a=e.readFileSync(o,"utf8"),a.match(r)||(console.log("ERROR: No app_schemas_marker found in "+o),process.exit()),a=a.replace(r,function(e){return"{MANIFEST-START}\n    doctored.schemas_manifest = "+JSON.stringify(m)+";\n    // {MANIFEST-END}"}),e.writeFileSync(o,a),console.log("Done. Manifest written to "+o)}();